const express = require('express');
const mongoose = require('mongoose');
const url = 'mongodb://127.0.0.1:27017';
const user = require('./models.js');

const app = express();

mongoose.connect(url,{useNewUrlParser:true});

const con = mongoose.connection;

con.on('open',function(){
    console.log("Connected.......")
})
app.use(express.json());

app.listen(9000,function(){
    console.log("App is running......")
})


app.post('/',async(req,res)=>{
    const newuser = new user({
        name:req.body.name,
        password:req.body.password,
        email:req.body.email,
        age:req.body.age
    })

    try{
        const u = await newuser.save();
        res.json(u)
    }
    catch(err){
        res.send("error");
        console.log("error is "+ err)
    }
})

app.get('/:id',async(req,res)=>{
    try{
        const oneuser = await user.findById(req.params.id)
        res.json(oneuser)
    }
    catch{
        res.send("something went wrong")
    }
})

app.put('/:id',async(req,res)=>{
    try{
        const oneuser = await user.findById(req.params.id);
        oneuser.name=req.body.name,
        oneuser.password=req.body.password,
        oneuser.email=req.body.email,
        oneuser.age=req.body.age

        const u = await oneuser.save();
        res.json(u)
    }
    catch{
        res.send("something went wrong")
    }
})

app.delete("/:id",async(req,res)=>{
    try{
        const oneuser = await user.findById(req.params.id);
        oneuser.deleteOne();

        res.send("record deleted")
    }
    catch{
        res.send("something went wrong")
    }
})








const mongoose = require("mongoose");

const user = new mongoose.Schema({
    name:{
        type:String,
        required:true
    },
    email:{
        type:String,
        required:true
    },
    password:{
        type:String,
        required:true
    },
    age:{
        type:Number,
        required:true
    }
})

module.exports = mongoose.model('user',user)
